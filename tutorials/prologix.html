

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>A Single GPIB Instrument with Prologix &mdash; dripline 0.0.2 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="dripline 0.0.2 documentation" href="../index.html"/>
        <link rel="up" title="Tutorials" href="tutorials.html"/>
        <link rel="next" title="Command Line Tools" href="../cli_tools.html"/>
        <link rel="prev" title="A Dripline powered key-value store" href="kv_store.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="../index.html" class="fa fa-home"> dripline</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../getting_started.html#libraries">Libraries!</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started.html#operating-system-python">Operating System &amp; Python</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../spec.html">Specifications</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../spec.html#abstractions">Abstractions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../spec.html#messages">Messages</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../contribute.html">Contribute</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../contribute.html#tdd-with-dripline">TDD with Dripline</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contribute.html#contributing-with-tdd">Contributing with TDD</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contribute.html#don-t-stop-there">Don&#8217;t stop there</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contribute.html#adding-tests">Adding Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contribute.html#mocking">Mocking</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="kv_store.html">A Dripline powered key-value store</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">A Single GPIB Instrument with Prologix</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../cli_tools.html">Command Line Tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../cli_tools.html#dripline-agent">dripline_agent</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cli_tools.html#start-node">start_node</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cli_tools.html#message-monitor">message_monitor</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">dripline</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="tutorials.html">Tutorials</a> &raquo;</li>
      
    <li>A Single GPIB Instrument with Prologix</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="../_sources/tutorials/prologix.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="a-single-gpib-instrument-with-prologix">
<h1>A Single GPIB Instrument with Prologix<a class="headerlink" href="#a-single-gpib-instrument-with-prologix" title="Permalink to this headline">¶</a></h1>
<p>This tutorial is for adding gpib devices to an existing dripline system.</p>
<div class="section" id="a-hardware-review">
<h2>A Hardware Review<a class="headerlink" href="#a-hardware-review" title="Permalink to this headline">¶</a></h2>
<p>For this example, we&#8217;ll consider the simple case of the Lecroy 9210 pulse generator being accessed via a prologix GPIB to ethernet controller.
Before we worry too much about dripline, we should understand some basics of how that hardware combination works.</p>
<p>The prologix controller is configured to a static IP address within the lab&#8217;s internal network.
A single socket can be opened to the controller and packets sent to it.
Commands that begin with &#8220;++&#8221; are for the controller itself, others are passed along to the currently addressed GPIB device.
The details of this are taken care of by dripline.</p>
<p>The Lecroy 9210, like any GPIB device, uses SCPI commands for configuration and control.
By reading through the manual, we find many useful commands which we may want to add.
In this example, we will consider two:</p>
<blockquote>
<div><ol class="arabic simple">
<li><a href="#id1"><span class="problematic" id="id2">*</span></a>IDN? is a command which instructs the device to return a comman separated list of identifying information (including make, model, serial number, etc.). It is used as a query, but does not accept configuration.</li>
<li>A:WID is a command which sets the width of an output pulse in seconds. It supports both a query mode <code class="docutils literal"><span class="pre">A:WID?</span></code> and a configuration mode <code class="docutils literal"><span class="pre">A:WID</span> <span class="pre">&lt;value&gt;</span></code>.</li>
</ol>
</div></blockquote>
<p>There are many further commands available for the 9210, they can be added in the same way as these two.</p>
</div>
<div class="section" id="configuring-a-service">
<h2>Configuring a Service<a class="headerlink" href="#configuring-a-service" title="Permalink to this headline">¶</a></h2>
<p>All of the details of our configuration will be contained in a single YAML configuration file.
The hierarchical structure of our configuration file will reflect the physical and conceptual relation between the various abstractions in dripline.</p>
<div class="section" id="the-service">
<h3>The Service<a class="headerlink" href="#the-service" title="Permalink to this headline">¶</a></h3>
<p>At the highest level, we will be running a single python application.
It is responsible for connecting to AMQP and dealing with communcation.
The service must be configured with a name, a network path to the amqp server, and a list of providers for which it is responsible (this last one comes in the next section).</p>
<p>We create a new configuration file and add that content, it should look like this:
(!!! I should be able to actually just ref line numbers in the source, rather than duplicate them in the rst...)</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">nodename</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">prologix_tutorial</span>
<span class="l-Scalar-Plain">broker</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">localhost</span>
</pre></div>
</div>
<p>Here I&#8217;ve named the service prologix_tutorial, since that&#8217;s what we&#8217;re doing.
I&#8217;ve set broker to localhost, this implies that there is an amqp server running on my local system.</p>
</div>
<div class="section" id="prologix-controller">
<h3>Prologix Controller<a class="headerlink" href="#prologix-controller" title="Permalink to this headline">¶</a></h3>
<p>Our service will own one provider, a single prologix controller.
We therefore add a (one element long) list of providers to the above servce, with the requisite configuration details.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">nodename</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">prologix_tutorial</span>
<span class="l-Scalar-Plain">broker</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">localhost</span>
<span class="l-Scalar-Plain">providers</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">prologix_controller</span>
    <span class="l-Scalar-Plain">module</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">PrologixSpimescape</span>
    <span class="l-Scalar-Plain">socket_info</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">(&quot;lagavoulin.local&quot;, 1234)</span>
</pre></div>
</div>
<p>Note that in addition to a name, I&#8217;ve assigned configuration values for module and socket_info.
The module is the name of a class within dripline.instrument (that should be linked) which our service will create.
Any keyworded arguments for that class&#8217;s __init__() may be specified in the same way that here I&#8217;ve set the socket_info.</p>
</div>
<div class="section" id="pulser-instrument">
<h3>Pulser Instrument<a class="headerlink" href="#pulser-instrument" title="Permalink to this headline">¶</a></h3>
<p>Now that we have the controller itself configured we want to add and configure the instrument(s) attached to it.
In this example, that is another one element list with only the Lecroy 9210.
That now looks like:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">nodename</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">prologix_tutorial</span>
<span class="l-Scalar-Plain">broker</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">localhost</span>
<span class="l-Scalar-Plain">providers</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">prologix_controller</span>
    <span class="l-Scalar-Plain">module</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">PrologixSpimescape</span>
    <span class="l-Scalar-Plain">socket_info</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">(&quot;lagavoulin.local&quot;, 1234)</span>
    <span class="l-Scalar-Plain">endpoints</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">lecroy_pulser</span>
        <span class="l-Scalar-Plain">module</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">GPIBInstrument</span>
        <span class="l-Scalar-Plain">addr</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">1</span>
</pre></div>
</div>
<p>Hopefully the pattern is starting to be clear.
There is a name assigned to the instrument, and a module which is another class in dripline.instrument.
Again from it&#8217;s __init__(), we&#8217;ve specified the value of addr (the GPIB address of the pulser).</p>
</div>
<div class="section" id="endpoints">
<h3>Endpoints<a class="headerlink" href="#endpoints" title="Permalink to this headline">¶</a></h3>
<p>Finally, we&#8217;ll add the actual commands that we want to be able to access via the slow controls.
They follow the same pattern as the last two.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">nodename</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">prologix_tutorial</span>
<span class="l-Scalar-Plain">broker</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">localhost</span>
<span class="l-Scalar-Plain">providers</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">prologix_controller</span>
    <span class="l-Scalar-Plain">module</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">PrologixSpimescape</span>
    <span class="l-Scalar-Plain">socket_info</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">(&quot;lagavoulin.local&quot;, 1234)</span>
    <span class="l-Scalar-Plain">endpoints</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">lecroy_pulser</span>
        <span class="l-Scalar-Plain">module</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">GPIBInstrument</span>
        <span class="l-Scalar-Plain">addr</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">1</span>
        <span class="l-Scalar-Plain">endpoints</span><span class="p-Indicator">:</span>
          <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">tickler_pulser_info</span>
            <span class="l-Scalar-Plain">module</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">SimpleGetSpime</span>
            <span class="l-Scalar-Plain">base_str</span><span class="p-Indicator">:</span> <span class="s">&quot;*IDN?&quot;</span>
          <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">tickler_pulse_width</span>
            <span class="l-Scalar-Plain">module</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">SimpleGetSetSpime</span>
            <span class="l-Scalar-Plain">base_str</span><span class="p-Indicator">:</span> <span class="s">&quot;A:WID&quot;</span>
</pre></div>
</div>
<p>And there we have it, a configuration to let us remind ourselves just what the pulser is, and set how long the pulses last.
To start it we use the open_spimescape_portal utility script (link to the help for it), if everything works, it should look something like:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>open_spimescape_portal -c /path/to/prologix_example.yaml
</pre></div>
</div>
<p>You can then open another terminal and interact with your endpoints:</p>
<div class="highlight-bash"><div class="highlight"><pre>something to get the identity
-with an output
and the initial pulse widht
-output
<span class="k">then</span> something to <span class="nb">set </span>the pulse width
-with output
and finally get that pulse width to see it is <span class="nb">set</span>
-output
</pre></div>
</div>
</div>
</div>
<div class="section" id="logging">
<h2>Logging<a class="headerlink" href="#logging" title="Permalink to this headline">¶</a></h2>
<p>Next we enable the logger(s) and see their outputs using the message monitor.</p>
<p>Finally the logger service is started and values stored to postgres.</p>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../cli_tools.html" class="btn btn-neutral float-right" title="Command Line Tools"/>Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="kv_store.html" class="btn btn-neutral" title="A Dripline powered key-value store"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014, The Project 8 Collaboration.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.0.2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>